-----------
-- PLANTILLA --
-----------

<!---
# Plantilla H1
## Plantilla H2
### Plantilla H3
-->
<!--- <img src="https://phoneky.co.uk/thumbs/screensavers/down/original/linux_3rj131p8.gif" />
-->

‚≠êÔ∏è **PLANTILLA** ‚≠êÔ∏è

| üî•PLANTILLA TALBA‚ùóüî• | 
| ------------- |
| *Plantilla* |


LINKS


https://sites.google.com/site/asixm06edt/home/uf2-automatitzacio-i-scripts 
https://gitlab.com/edtasixm06/ipc-2019

--------------------------------------------------------------------------------

UF2 - Scripts / Programaci√≥ de Sistemes

IPC Inter Process Comunication


# 14-popen-sql-multi py

----

<pre><font color="#859900"><b>isx36579183@i11</b></font>:<font color="#268BD2"><b>~/Documents/ipc</b></font>$ cat 14-popen-sql-multi.py 
# /usr/bin/python
#-*- coding: utf-8-*-
#
# popen-sql-multi.py
# *nota* no tracta el cas de num_clie inexistent
# -------------------------------------
# @ edt ASIX M06 Curs 2019-2020
# Gener 2020
# -------------------------------------
# Utilitza el docker edtasixm06/postgres
# -----------------------------------------
#commandLocal = &quot;psql -qtA -F &apos;;&apos; lab_clinic -c &apos;select * from pacients;&apos;&quot;
#commandRemote = &quot;psql -qtA -h i11 -U postgres -F &apos;;&apos; training -c &quot;select * from oficinas;&quot;
# -------------------------------------------
import sys
from subprocess import Popen, PIPE
import argparse
#clieList=[]
parser = argparse.ArgumentParser(description=&apos;Consulta SQL interactiva&apos;)
parser.add_argument(&quot;-d&quot;,&quot;--database&quot;, help=&quot;base de dades a usar&quot;,\
     default=&quot;training&quot;)
parser.add_argument(&apos;-c&apos;,&quot;--client&quot;, help=&apos;client&apos;,type=str,\
     action=&quot;append&quot;,dest=&quot;clieList&quot;,required=&quot;True&quot;)
args = parser.parse_args()

cmd = &quot;psql -qtA -F&apos;,&apos; -h 172.17.0.2 -U postgres &quot;+ args.database
pipeData = Popen(cmd, shell = True, bufsize=0, universal_newlines=True, stdin=PIPE, stdout=PIPE, stderr=PIPE)

for num_clie in args.clieList:
  sqlStatment=&quot;select * from clientes where num_clie=%s;&quot; % (num_clie)
  pipeData.stdin.write(sqlStatment+&quot;\n&quot;)
  print(pipeData.stdout.readline(), end=&quot;&quot;)

pipeData.stdin.write(&quot;\q\n&quot;)
sys.exit(0)
</pre>

----


psql -qtA -F',' training -c "select * from clientes where num_clie=21;"

psql -qtA -F',' -h 172.17.0.2 -U edtasixm06 training -c "select * from clientes where num_clie=21;"







# VERIFICACI√ìN



python3 14-popen-sql-multi.py -c 2111 -c 2111

isx36579183@i11:~/Documents/ipc$ python3 14-popen-sql-multi.py -c 2111 -c 2111
2111,JCP Inc.,103,50000.00
2111,JCP Inc.,103,50000.00
isx36579183@i11:~/Documents/ipc$ 


python3 14-popen-sql-multi.py -c 2111 -c 2111 -c 2102 -c 2103

isx36579183@i11:~/Documents/ipc$ python3 14-popen-sql-multi.py -c 2111 -c 2111 -c 2102 -c 2103
2111,JCP Inc.,103,50000.00
2111,JCP Inc.,103,50000.00
2102,First Corp.,101,65000.00
2103,Acme Mfg.,105,50000.00
isx36579183@i11:~/Documents/ipc$ 


* No es capaz de leer una respuesta, por si le ponemos PERE.

* No se


# Soluci√≥n 14


----



# SIGNALS


$ ---> []

* Kill -1s Sigterm

* Kill -9 Sigkill

kill -l --> Obtenemos ...

```
isx36579183@i11:~/Documents/ipc$ kill -l
 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP
 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1
11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM
16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP
21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ
26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR
31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3
38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8
43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13
48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12
53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7
58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2
63) SIGRTMAX-1	64) SIGRTMAX	
isx36579183@i11:~/Documents/ipc$ 

```

* Nos interesa tener.

1. 1 SIGHUP --> Hace un reinicio del DEMONIO.

	SIGINT --> ES CTRL + C [SIG INTERRUMPIR --> DEJAR√Å DE FUNCIONAR]

2. 9 SIGKILL --> Mata un proceso.

3. 10 SIGUSER1 --> Son se√±ales VAC√çAS para que se puedan programar el USUARIO.

4. 12 SIGUSER2 --> Definidos por el usaurio.

5. 14 SIGALRM --> Genera una alarma.

6. 15 SIGTERM --> Termina / acaba procesos

7. 18 SIGCONT --> Continua un proceso

8. 19 SIGSTOP --> Para un proceso CTRL + Z





*EJEMPLOS*

sleep 9999999 --> ^C matarlo


sleep 9999999 --> ^Z aturarlo



pgrep sleep --> Obtenemos el PID del SLEEP


kill -2 [pid_sleep] --> Matarlo



kill -19 $(pgrep sleep) --> Para proceso

[1]+  Stopped                 sleep 99999999
isx36579183@i11:~/Documents/ipc$ 


kill -19 $(pgrep sleep) --> Para proceso

jobs


--- Segundo plano

isx36579183@i11:~/Documents/ipc$ jobs
[1]+  Running                 sleep 99999999 &
isx36579183@i11:~/Documents/ipc$ 

---


# apt-get update

# apt-get install apache2

# systemctl start apache2

# systemctl status apache2

# ps ax --> Enciende 3 procesos del C Group

# pstree --> Enciende procesos

# pstree -pl 


----
root@i11:~# pstree -pl 10311
apache2(10311)‚îÄ‚î¨‚îÄapache2(10312)‚îÄ‚î¨‚îÄ{apache2}(10318)
               ‚îÇ                ‚îú‚îÄ{apache2}(10320)
               ‚îÇ                ‚îú‚îÄ{apache2}(10322)
               ‚îÇ                ‚îú‚îÄ{apache2}(10324)
               ‚îÇ                ‚îú‚îÄ{apache2}(10326)
               ‚îÇ                ‚îú‚îÄ{apache2}(10329)
               ‚îÇ                ‚îú‚îÄ{apache2}(10331)
               ‚îÇ                ‚îú‚îÄ{apache2}(10332)
               ‚îÇ                ‚îú‚îÄ{apache2}(10336)
               ‚îÇ                ‚îú‚îÄ{apache2}(10338)
               ‚îÇ                ‚îú‚îÄ{apache2}(10340)
               ‚îÇ                ‚îú‚îÄ{apache2}(10341)
               ‚îÇ                ‚îú‚îÄ{apache2}(10342)
               ‚îÇ                ‚îú‚îÄ{apache2}(10343)
               ‚îÇ                ‚îú‚îÄ{apache2}(10344)
               ‚îÇ                ‚îú‚îÄ{apache2}(10349)
               ‚îÇ                ‚îú‚îÄ{apache2}(10351)
               ‚îÇ                ‚îú‚îÄ{apache2}(10353)
               ‚îÇ                ‚îú‚îÄ{apache2}(10355)
               ‚îÇ                ‚îú‚îÄ{apache2}(10356)
               ‚îÇ                ‚îú‚îÄ{apache2}(10357)
               ‚îÇ                ‚îú‚îÄ{apache2}(10358)
               ‚îÇ                ‚îú‚îÄ{apache2}(10364)
               ‚îÇ                ‚îú‚îÄ{apache2}(10366)
               ‚îÇ                ‚îú‚îÄ{apache2}(10367)
               ‚îÇ                ‚îî‚îÄ{apache2}(10368)
               ‚îî‚îÄapache2(10313)‚îÄ‚î¨‚îÄ{apache2}(10317)
                                ‚îú‚îÄ{apache2}(10319)
                                ‚îú‚îÄ{apache2}(10321)
                                ‚îú‚îÄ{apache2}(10323)
                                ‚îú‚îÄ{apache2}(10325)
                                ‚îú‚îÄ{apache2}(10327)
                                ‚îú‚îÄ{apache2}(10328)
                                ‚îú‚îÄ{apache2}(10330)
                                ‚îú‚îÄ{apache2}(10333)
                                ‚îú‚îÄ{apache2}(10334)
                                ‚îú‚îÄ{apache2}(10335)
                                ‚îú‚îÄ{apache2}(10337)
                                ‚îú‚îÄ{apache2}(10339)
                                ‚îú‚îÄ{apache2}(10345)
                                ‚îú‚îÄ{apache2}(10346)
                                ‚îú‚îÄ{apache2}(10347)
                                ‚îú‚îÄ{apache2}(10348)
                                ‚îú‚îÄ{apache2}(10350)
                                ‚îú‚îÄ{apache2}(10352)
                                ‚îú‚îÄ{apache2}(10354)
                                ‚îú‚îÄ{apache2}(10359)
                                ‚îú‚îÄ{apache2}(10360)
                                ‚îú‚îÄ{apache2}(10361)
                                ‚îú‚îÄ{apache2}(10362)
                                ‚îú‚îÄ{apache2}(10363)
                                ‚îî‚îÄ{apache2}(10365)


----

kill -1 10311 [SIGHUP]



--------------------------------

CTRL + Q --> 18

CTRL + S --> 19

-------------------------------------


VIM 15

https://docs.python.org/3/library/signal.html?highlight=signal#module-signal 

15-exemple-signal.py

Programa d'exemple del funcionament de signal.
Defineix handlers i els assigna als senyals
sigalarm i sigterm. Finalitza autom√†ticament
en passar els n segons de l'alarma definida.

----
# /usr/bin/python3
#-*- coding: utf-8-*-
#
# signal-exemple.py
# -------------------------------------
# @ edt ASIX M06 Curs 2019-2020
# Gener 2020
# -------------------------------------
import sys, os, signal

# LIBRERIAS DE PYTHON 

def myhandler(signum,frame):
  print("Signal handler called with signal:", signum)
  print("hasta luego lucas!")
  sys.exit(1)
  
# Es una funci√≥n, es un m√©todo "myhandler" que recibir√° se√±ales --> Recibir√° una estructura de datos que representa una se√±al y har√° una serie de Acciones.

# La funci√≥n despu√©s TERMINA --> con sys.exit(1).

# TERMINAMOS .

# Tenemos una FUNCI√ìN donde RECIBE SE√ëALES y EJECUTA la funci√≥n.

# Un handler es cuando le pasen algo hace algo especial.  
  


def mydeath(signum,frame):
  print("Signal handler called with signal:", signum)
  print("no em dona la gana de morir!")

# Funci√≥n donde MATA el proceso.
  
signal.signal(signal.SIGALRM,myhandler) # 14
signal.signal(signal.SIGUSR2,myhandler) # 12
signal.signal(signal.SIGUSR1,mydeath)   # 10
signal.signal(signal.SIGTERM,signal.SIG_IGN)
signal.signal(signal.SIGINT,signal.SIG_IGN)
signal.alarm(60)

# signal.signal permite asociar una FUNCI√ìN con una SE√ëAL. Cuando el programa reciba la SE√ëAL, ejecutar√° una FUNCI√ìN.

# signal. SIG_IGN --> Cuando reciba la se√±al SIGTERM --> Ignora 

# signal.alarm(60) --> Define que 60 segundos suene una alarma.

print(os.getpid())
while True:
  pass
signal.alarm(0)
sys.exit(0)

# Printa el PID DEL PROGRAMA Y HACE UN BUCLE INFINITO. os.getpid() --> Obtiene el PID del PROCESO

# WHILE TRUE

----

*EJECUCI√ìN*

*Si no ejecutas algo en 60 segundos, termina y printa*. Envia la SE√ëAL 14. SIGALRM.

kill -15 11469 --> IGNORA

kill -10 11469 --> NO QUIERE MORIRSE

isx36579183@i11:~/Documents/ipc$ python3 15-exemple-signals.py 
11511
Signal handler called with signal: 10
no em dona la gana de morir!


kill -12 11511 --> Termina

isx36579183@i11:~/Documents/ipc$ kill -12 11511
isx36579183@i11:~/Documents/ipc$ 

Signal handler called with signal: 12
hasta luego lucas!
isx36579183@i11:~/Documents/ipc$ 


kill -2 11469 --> IGNORA

CTRL + C --> SE AUTOPROTEGE

--------------------------------------------------


#16-SIGNAL.PY 16

* PASADOS N SEGUNDOS --> TERMINAR CON SIGALRM.

* SIGUSER1 --> +1 MINUT --> HAR√Å QUE LA ALARMA SER√Å 1 MINUTO M√ÅS (+ 60 SEGUNDOS).

* SIGUSER2 --> -1 MINUTO --> HAR√Å QUE LA ALARMA SER√Å -1 MINUTO M√ÅS (- 60 SEGUNDOS).

* SI RECIBE SIGHUP -> REINICIAR EL CONTADOR --> PONE EL VALOR ORIGINAL DEL CONTADOR.

* SIGTERM --> MOSTRAR CUANTOS SEGUNDOS FALTAN.

	* LOS CUENTA EL SISTEMA.
	
---
	
* El programa no permite que se haga CTRL + C.

* SIGALARM --> N√∫mero de UP y DOWN y ACABA.



HELP -- TENER CONTADORES PARA CADA UNO




